# Chapter 1
#  
## 엘라스틱서치: 분산 검색엔진
  ```
    엘라스틱 서치는 검색엔진이지만 일반적인 네이버, 구글같은 검색포털과는 다르다.

    검색엔진은 내부적으로 각 도큐먼트를 엔덱싱하고 빠르게 검색하는데 사용하는 기술로, 네이버나 구글같은 검색 포털은 해당 검색엔진을 사용하여 만들게된다.

    엘라스틱 서치는 모든 레코드를 JSON 형태로 관리하고, 요청된 쿼리에 일치하는 결과값만 반환한다.
    엘라스틱 서치는 텍스트나 도큐먼트의 경우, 인덱싱 시점에 분석을 거쳐 용어 단위로 분해되고 역인덱스 사전을 구축한다.

    이렇게 최적화된 자료구조들을 바탕으로 병렬처리나 분산처리를 할 수 있다.

  ```
#  
  `검색엔진`
  ```
    엘라스틱 서치가 다른 관계형 DB나 다른 NoSQL DB에 비해 빠른 검색과 집계 성능을 실형하는 이유는, 검색엔진이면서 DB이기 때문이다.

    엘라스틱서치는 몽고디비와 같은 도큐먼트 형태의 NoSQL이지만, 검색과 성능이라는 측면에서 가장 크게 구별된다.

    특히 검색엔진으로써 가장 큰 특징중 하나는 스코어링, 즉 연관도에 따른 정렬이다.

    단순히 필드값을 기준으로 한 정렬은 어떤 종류의 데이터베이스에서도 제공되지만,
    엘라스틱 서치는 다양한 스코어링 방법을 포함하여 사용자가 정렬방식을 직접 정의할 수 있다.
  ```
#  
  - ![es_01](https://github.com/pnci1029/TIL/assets/81909140/25461efe-c96b-447b-9010-97f1759df8c7)
  `분산 시스템`
  ```
    엘라스틱 서치는 분산시스템으로서 복수의 인스턴스를 병렬로 배치하고 분산처리를 하여,
    검색속도를 무한히 확장 할 수 있게 했다.

    또한 노드간 복제 기능을 통해 일부 노드가 다운되더라도 정상적으로 서비스를 지숙가능하게 해준다.
    무엇보다 RestApi를 통해 프로그래밍 언어와 무관하게 사용자가 직접 접근할 수 있도록 활용성이 높다.

  ```
#  
  `단점` 
  ```
    그러나 저장공간이 크게 압축되지 않고 시스템 리소스를 많이사용하는 단점도 있다.

    그리고 DSL 쿼리를 사용하는데, JOIN코리가 어렵기 떄문에 사실상 반정규화를 기본으로 모델링해야한다.

    또한 인덱스가 불변의 자료구조이기때문에 도큐먼트를 수정하거나 사용할 경우 비용이 저렴하지않다.

    이러한 단점들은 검색 성능을 끌어올리기위해 트레이드오프가 이뤄진것으로,
    대량의 데이터를 처리할 때는 일반적으로 용인되는 제약이다.

    결과적으로 대용량 데이터에 대한 빠른 검색과 집계가 필요할 경우 고려해야하는 데이터베이스라고 할 수 있다.
  ```
#  
  -![키바나](https://github.com/pnci1029/TIL/assets/81909140/ea92a404-6818-4dcf-9254-7b90714f4774)
  `키바나`
  ```
    엘라스틱 서치가 RestApi가 잘 설계되었지만 복잡한 요청을 일일이 작성하기엔 불편함이 있다.

    키바나는 이런 불편함을 해소시켜주고 일종의 엘라스틱서치의 UI역할을 담당한다.

    엘라스틱 서치의 대부분의 관리기능, API콘솔, 모니터링 페이지등이 키바나에 포함된다.


    무엇보다 큰 특징은 시각화 대시보드이다.
    일반적으로 여러 차트나 그래프등의 시각도구들을 쉽게 구성하게해주고,
    이런 기능들이 엘라스틱서치의 대중화와 확산에 큰 공헌을 했다.
  ```
#  
  `로그스태시`
  ```
    로그스태시는 이벤트 수집과 정제를 위한 도구이다.

    대량의 데이터를 검색하기 위해 가장 먼저 선행돼아 할 작업은 데이터를 적재하는것이다.

    이는 빅데이터를 다룰 때 가장 손이 많은 작업이며, 엘라스틱 서치의 데이터 수집과 가공 기능은 로그스태시를 사용한다.
  ```
# Chapter 2
#  
  ```
  
  ```
# Chapter 3
## 엘라스틱 서치 기본
  ```
    처음 새로운 시스템을 접하게되면 두가지 난간에 부딪힌다.
    시스템을 알기위해서는 용어와 개념이 필요하다.

    새로 접한 시스템에서 용어와 개념은 머리에 들어오지않고, 결과적으로 시스템을 이해하기 어렵다.

    직접 검색엔진을 구축해본 경험이 없는 이상

    엘라스틱 서치 역시 마찬가지다.
  ```
  ```
    엘라스틱 서치를 제대로 활용하기 위해서는

    저장과 인출방식을 확실해 이해해야한다.

    1. 인출을 위해서는 가장먼저 저장이 필요하다.

    2. 저장을 하기위해서는 스키마를 구성하고 데이터를 집어넣어야한다.

    3. 이 과정에서 데이터 타입을 배우고 검색 내부 동작을 이해한다.
  ```
### 엘라스틱 서치 API 활용
#### 시스템 상태 확인
  - <img width="1661" alt="스크린샷 2023-07-19 오후 10 42 10" src="https://github.com/pnci1029/TIL/assets/81909140/0e9434d4-19fb-4012-8c37-f7fa7b9640b8">
  ```
    키바나 콘솔을 통해 현재 엘라스틱 서치의 상태를

    cat API를 사용하여 확인이 가능하다.
    해당 API를 사용하여 주로 노드, 샤드, 템플릿등의 상태나 통계정보를 확인하며

    현재 클러스터의 상태를 빠르게 확인이 가능하다.
    
  ```
#### 인덱스와 도큐먼트
  ```
    엘라스틱 서치를 이해하기 위해 인덱스와 도큐먼트는 매우 중요한 요소이다..

    인덱스는 도큐먼트를 저장하는 논리적 구분자이며, 도큐먼트는 실제 데이터를 저장하는 단위이다.
    아래 이미지는 클러스터, 인덱스, 도큐먼트들 간의 관계를 시각적으로 보여준다.
  ```
  - ![엘라1](https://github.com/pnci1029/TIL/assets/81909140/a99285e1-a3e5-4b73-a2c9-f5a00bf94243)
  ```
    1. 일반적으로 하나의 프로젝트에서 하나의 클러스터를 생성한다.

    2. 클러스터 내부에는 데이터 성격에 따른 여러개의 인덱스를 생성하고,

    3. 인덱스 내부에는 JSON 형태로 된 다수의 도큐먼트들이 존재하며,

    4. 도큐먼트는 복수의 필드들을 갖는다.
  ```
  `도큐먼트`
  ```
    도큐먼트는 데이터가 저장되는 기본 단위로 JSON형태이다.

    하나의 도큐먼트는 여러 필드와 값(value)를 갖는다.
  ```
  `인덱스`
  ```
    인덱스는 도큐먼트를 저장하는 논리적 단위이다.

    관계형 데이터베이스의 테이블과 유사한 개념으로, 하나의 인덱스에 다수의 도큐먼트를 갖는 구조를 갖는다.

    동일한 인덱스에 있는 도큐먼트는 동일한 스키마를 갖는다.
    인덱스 이름은 영어는 대문자로만 사용이 가능하며, 255바이트를 넘을 수 없다.
  ```
#### 도큐먼트 CRUD
  `인덱스 생성/확인/삭제`
    - <img width="1647" alt="스크린샷 2023-07-19 오후 11 04 18" src="https://github.com/pnci1029/TIL/assets/81909140/624d816f-bd40-4803-9ca7-37b626bf74e9">
  ```
    도큐먼트는 반드시 하나의 인덱스에 포함되어야한다. 따라서 도큐먼트를 생성하기전 인덱스 생성이 필요하다.

    인덱스 생성
    PUT test_index

    인덱스 조회
    GET test_index

    인덱스 삭제
    DELETE test_index
  ```
  `도큐먼트 생성`
    - <img width="1668" alt="스크린샷 2023-07-19 오후 11 06 21" src="https://github.com/pnci1029/TIL/assets/81909140/e909622e-df6c-49ab-9c66-236294c20f05">
  ```
    PUT test_index/_doc/1
    {
      "name" : "tester",
      "age" : 10,
      "gender" : "female"
    }

    생성된 인덱스에 name, age, gender 필드를 가지는 도큐먼트 생성
  ```
  `도큐먼트 조회`
    - <img width="1679" alt="스크린샷 2023-07-19 오후 11 07 57" src="https://github.com/pnci1029/TIL/assets/81909140/6e481623-3e30-456e-9782-f941785d9c8e">
  ```
    GET test_index/_doc/1
  ```
  `도큐먼트 수정`
  ```
    특정 필드값 수정 시
    PUT test_index/_doc/1
    {
      "name" : "tester1",
      "age" : 15,
      "gender" : "female"
    }

    혹은 _update API를 사용하여 특정 필드만 추가 업데이트도 가능하다.
    PUT test_index/_doc/1
    {
    "doc":{
        "name" : "tester111111",
      }
    }
  ```
  `도큐먼트 삭제`
  ```
    DELETE test_index/_doc/1
  ```






